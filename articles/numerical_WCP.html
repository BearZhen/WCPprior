<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="WCPprior">
<title>Numerical approximations of WCP priors â€¢ WCPprior</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Roboto_Slab-0.4.8/font.css" rel="stylesheet">
<!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Numerical approximations of WCP priors">
<meta property="og:description" content="WCPprior">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">WCPprior</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Functions</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-vignettes">Vignettes</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-vignettes">
    <a class="dropdown-item" href="../articles/numerical_WCP.html">Numerical approximations of WCP priors</a>
    <a class="dropdown-item" href="../articles/INLA_and_Stan_utilities.html">Bridge to R-INLA and Stan</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/vpnsctl/WCPprior/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Numerical approximations of WCP priors</h1>
            
            <h4 data-toc-skip class="date">Created: 2023-12-13. Last
modified: 2023-12-13.</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/vpnsctl/WCPprior/blob/HEAD/vignettes/numerical_WCP.Rmd" class="external-link"><code>vignettes/numerical_WCP.Rmd</code></a></small>
      <div class="d-none name"><code>numerical_WCP.Rmd</code></div>
    </div>

    
    
<p>In this vignette, we will show how to use the WCPprior package to
obtain 1D and 2D numerical and analytic WCP prior.</p>
<p>Import relevant libraries.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://vpnsctl.github.io/WCPprior/">WCPprior</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="bivariate-wcp_2-prior-of-mean-and-standard-deviation-of-gaussian-distribution-">Bivariate WCP<span class="math inline">\(_2\)</span> prior of mean
and standard deviation of Gaussian distribution.<a class="anchor" aria-label="anchor" href="#bivariate-wcp_2-prior-of-mean-and-standard-deviation-of-gaussian-distribution-"></a>
</h2>
<p>The theoretical details of deriving bivariate WCP prior density can
be found on Recipe 1, Section 4.2 from <a href="https://arxiv.org/pdf/2312.04481.pdf" class="external-link uri">https://arxiv.org/pdf/2312.04481.pdf</a>, and its
implementation details can be found on Recipe 4, Section 5.2 from the
same document.</p>
<p>The function that gives numerical approximation of bivariate WCP
prior requires some information.<br></p>
<ol style="list-style-type: decimal">
<li>A function that takes values of the two-dimensional parameter <span class="math inline">\(\boldsymbol{\theta} = (\theta_1,
\theta_2)\)</span> and returns the Wasserstein distance <span class="math inline">\(W(\boldsymbol{\theta})\)</span>.</li>
<li>
<span class="math inline">\(\eta\)</span>, the user-specified
hyperparameter for WCP prior.</li>
<li>cutoff parameter that determines upper bound of the Wasserstein
distance <span class="math inline">\(W\)</span> in case of the parameter
space <span class="math inline">\(\boldsymbol{\theta}\)</span> is
unbounded. That is, by solving <span class="math inline">\(P(W &gt; w) =
\text{cutoff}\)</span>, the upper bound <span class="math inline">\(w =
-log(\text{cutoff})/\eta\)</span>. Thus, we can approximate the WCP
prior on a bounded domain.<br>
</li>
<li>region information that specifies boundary of the bounded domain of
<span class="math inline">\(\boldsymbol{\theta}\)</span> determined by
cutoff, type of shape of the domain.<br>
</li>
<li>mesh width that determine how fine the mesh is on the bounded
domain.<br>
</li>
</ol>
<p>Let us define the Wasserstein distance function, where
<code>x[1]</code> is the mean parameter, <code>x[2]</code> is the
standard deviation parameter:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">W_func</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">^</span><span class="fl">2</span><span class="op">+</span><span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">}</span></span></code></pre></div>
<p>We now define the parameters and the region:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cutoff</span> <span class="op">=</span> <span class="fl">0.01</span></span>
<span><span class="va">mesh_width</span> <span class="op">=</span> <span class="fl">0.3</span></span>
<span><span class="co"># user-specified hyperparameter</span></span>
<span><span class="va">eta</span> <span class="op">=</span> <span class="fl">1</span></span>
<span></span>
<span><span class="va">region</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">'conic'</span>, lower_angle <span class="op">=</span> <span class="fl">0</span>, </span>
<span>upper_angle <span class="op">=</span> <span class="va">pi</span>, base_theta <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Observe that the type of region is <code>conic</code>, the range of
the angle of the conic region is from 0 to <span class="math inline">\(\pi\)</span> and the base model parameter is
<code>(0,0)</code>.</p>
<p>The following code performs the approximation by using the
<code><a href="../reference/WCP_2D_Numerical_Density.html">WCP_2D_Numerical_Density()</a></code> function. By setting
<code>parallel = TRUE</code>, user can run the function with multiple
cores and <code>NumCores</code> specifies number of cores. We will set
<code>visual_mesh = TRUE</code> to obtain a plot of the region along
with the constructed mesh.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">result</span> <span class="op">=</span> <span class="fu"><a href="../reference/WCP_2D_Numerical_Density.html">WCP_2D_Numerical_Density</a></span><span class="op">(</span><span class="va">W_func</span>,</span>
<span>                          eta <span class="op">=</span> <span class="va">eta</span>,</span>
<span>                          mesh_width <span class="op">=</span> <span class="va">mesh_width</span>, </span>
<span>                          cutoff <span class="op">=</span> <span class="va">cutoff</span>, </span>
<span>                          region <span class="op">=</span> <span class="va">region</span>,</span>
<span>                          parallel <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                          NumCores <span class="op">=</span> <span class="fl">2</span>,</span>
<span>                          visual_mesh <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="numerical_WCP_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
<p>This function returns the values of the approximated density along
the level curves. Our goal now is to plot the approximated density. To
this end, we will obtain the approximated values at the mesh, then plot
its values on a pixelated cover of the mesh.</p>
<p>We begin by extracting the mesh and creating a pixelized mesh with
the <code><a href="https://inlabru-org.github.io/fmesher/reference/fm_pixels.html" class="external-link">fm_pixels()</a></code> function from the <code>fmesher</code>
package.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://inlabru-org.github.io/fmesher/" class="external-link">fmesher</a></span><span class="op">)</span></span>
<span><span class="va">mesh</span> <span class="op">&lt;-</span> <span class="va">result</span><span class="op">$</span><span class="va">mesh</span></span>
<span><span class="va">pxl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://inlabru-org.github.io/fmesher/reference/fm_pixels.html" class="external-link">fm_pixels</a></span><span class="op">(</span><span class="va">mesh</span><span class="op">)</span></span></code></pre></div>
<p>We will now obtain the values of the approximated density at the mesh
nodes. To this end, we need the elements <code>basis</code> and
<code>val</code> from the returned list. The <code>basis</code> contains
the matrix that maps the level curve locations to the mesh nodes, and
<code>val</code> contains the values of the approximated density at the
level curve locations.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">basis</span> <span class="op">&lt;-</span> <span class="va">result</span><span class="op">$</span><span class="va">basis</span></span>
<span><span class="va">dens_val</span> <span class="op">&lt;-</span> <span class="va">result</span><span class="op">$</span><span class="va">val</span> </span>
<span><span class="va">dens_mesh</span> <span class="op">&lt;-</span> <span class="va">basis</span><span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span><span class="va">dens_val</span></span></code></pre></div>
<p>Let us obtain the values of the approximated density at the pixelated
mesh:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pxl</span><span class="op">$</span><span class="va">val</span> <span class="op">&lt;-</span> </span>
<span>    <span class="fu"><a href="https://inlabru-org.github.io/fmesher/reference/fm_evaluate.html" class="external-link">fm_evaluate</a></span><span class="op">(</span><span class="va">mesh</span>, <span class="va">pxl</span>, field <span class="op">=</span> </span>
<span>      <span class="va">dens_mesh</span><span class="op">)</span></span></code></pre></div>
<p>Let us now plot the approximated density in log scale:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://sjmgarnier.github.io/viridis/" class="external-link">viridis</a></span><span class="op">)</span></span>
<span></span>
<span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_tile</a></span><span class="op">(</span></span>
<span>      data <span class="op">=</span> <span class="va">pxl</span>,</span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>geometry <span class="op">=</span> <span class="va">geometry</span>, fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">val</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      stat <span class="op">=</span> <span class="st">"sf_coordinates"</span></span>
<span>    <span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://sjmgarnier.github.io/viridis/reference/scale_viridis.html" class="external-link">scale_fill_viridis</a></span><span class="op">(</span><span class="op">)</span> </span></code></pre></div>
<p><img src="numerical_WCP_files/figure-html/unnamed-chunk-8-1.png" width="700"></p>
<p>Now we show the absolute error between the true and the approximated
densities. We begin by obtaining the values of the true density at the
pixelated locations:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span><span class="va">coord_pxl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html" class="external-link">st_coordinates</a></span><span class="op">(</span><span class="va">pxl</span><span class="op">)</span></span>
<span><span class="co"># compute the true density</span></span>
<span><span class="va">true_WCP_density</span> <span class="op">=</span> <span class="op">(</span> <span class="fl">1</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">coord_pxl</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">^</span><span class="fl">2</span> <span class="op">+</span> </span>
<span>                <span class="va">coord_pxl</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">)</span> <span class="op">*</span> <span class="va">eta</span> <span class="op">*</span> </span>
<span>                <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">eta</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">coord_pxl</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">^</span><span class="fl">2</span> <span class="op">+</span> </span>
<span>                <span class="va">coord_pxl</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="va">pi</span></span></code></pre></div>
<p>We can now add the absolute errors at the <code>pxl</code> list:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pxl</span><span class="op">$</span><span class="va">error</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">pxl</span><span class="op">$</span><span class="va">val</span> <span class="op">-</span> <span class="va">true_WCP_density</span><span class="op">)</span></span></code></pre></div>
<p>Now, the error plot in log scale:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_tile</a></span><span class="op">(</span></span>
<span>      data <span class="op">=</span> <span class="va">pxl</span>,</span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>geometry <span class="op">=</span> <span class="va">geometry</span>, fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">error</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      stat <span class="op">=</span> <span class="st">"sf_coordinates"</span></span>
<span>    <span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://sjmgarnier.github.io/viridis/reference/scale_viridis.html" class="external-link">scale_fill_viridis</a></span><span class="op">(</span><span class="op">)</span> </span></code></pre></div>
<p><img src="numerical_WCP_files/figure-html/unnamed-chunk-11-1.png" width="700"></p>
<p>To compute the total variation distance between the true and
approximated distribution, we can do the following. We start by obtainig
the lumped mass matrix, which is a matrix that contains the areas of the
triangles of the mesh:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mass_lump_C</span> <span class="op">&lt;-</span> <span class="va">result</span><span class="op">$</span><span class="va">C</span></span></code></pre></div>
<p>Let us now obtain the value of the true density at the mesh
locations:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">true_WCP_density_mesh</span> <span class="op">=</span> <span class="op">(</span> <span class="fl">1</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">mesh</span><span class="op">$</span><span class="va">loc</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">^</span><span class="fl">2</span> <span class="op">+</span> </span>
<span>                <span class="va">mesh</span><span class="op">$</span><span class="va">loc</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">)</span> <span class="op">*</span> <span class="va">eta</span> <span class="op">*</span> </span>
<span>                <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">eta</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">mesh</span><span class="op">$</span><span class="va">loc</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">^</span><span class="fl">2</span> <span class="op">+</span> </span>
<span>                <span class="va">mesh</span><span class="op">$</span><span class="va">loc</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="va">pi</span></span></code></pre></div>
<p>We can now compute the approximation of the total variation norm:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">TVD_error</span> <span class="op">=</span> <span class="fl">0.5</span> <span class="op">*</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">mass_lump_C</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> </span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">dens_mesh</span>,ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">-</span> </span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">true_WCP_density_mesh</span>,ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>        <span class="va">cutoff</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">TVD_error</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 0.01857961</span></span></code></pre>
<p>The <code>WCPprior</code> package also provides a function to compute
point-wise analytic bivariate WCP<span class="math inline">\(_2\)</span>
prior of mean and standard deviation of Gaussian distribution. To use
this function, users just need to provide values of parameters, <span class="math inline">\(\eta\)</span> and base model mean parameter <span class="math inline">\(\text{base_mean}\)</span>. The base model standard
deviation parameter is fixed to 0. Now we use this function to compute
the densities on all the coordinates where the numerical approximation
densities are computed.</p>
<p>Let us start by obtaining the analytic density with the help of the
<code><a href="../reference/WCP2_2D_Gaussian_analytic.html">WCP2_2D_Gaussian_analytic()</a></code> function</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">analytic_density</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">coord_pxl</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">analytic_density</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">=</span> </span>
<span>            <span class="fu"><a href="../reference/WCP2_2D_Gaussian_analytic.html">WCP2_2D_Gaussian_analytic</a></span><span class="op">(</span>mean <span class="op">=</span> </span>
<span>                      <span class="va">coord_pxl</span><span class="op">[</span><span class="va">i</span>,<span class="fl">1</span><span class="op">]</span>, </span>
<span>                      std <span class="op">=</span> <span class="va">coord_pxl</span><span class="op">[</span><span class="va">i</span>,<span class="fl">2</span><span class="op">]</span>,</span>
<span>                      eta <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                      base_mean <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Let us now compare the above density with the true density we
computed manually:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">true_WCP_density</span> <span class="op">-</span> <span class="va">analytic_density</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 0</span></span></code></pre>
<p>We will now plot the analytic density:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">coord_pxl</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span>,</span>
<span>          <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">coord_pxl</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span>,</span>
<span>          <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">analytic_density</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">data</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="va">g</span> <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">data</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">X1</span>, <span class="va">X2</span>, fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">X3</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_raster</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://sjmgarnier.github.io/viridis/reference/scale_viridis.html" class="external-link">scale_fill_viridis</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">theta</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">theta</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>col <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_colourbar.html" class="external-link">guide_colourbar</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Density"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"top"</span>,</span>
<span>        legend.key.height <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="st">'cm'</span><span class="op">)</span>, <span class="co">#change legend key height</span></span>
<span>        legend.key.width <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="st">'cm'</span><span class="op">)</span>, <span class="co">#change legend key width</span></span>
<span>        legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">7</span><span class="op">)</span>, <span class="co">#change legend title font size</span></span>
<span>        legend.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">5</span><span class="op">)</span>,<span class="co">#change legend text font size</span></span>
<span>        axis.text<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">7</span><span class="op">)</span>,</span>
<span>        axis.title<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">7</span><span class="op">)</span><span class="op">)</span> </span>
<span><span class="va">g</span></span></code></pre></div>
<p><img src="numerical_WCP_files/figure-html/unnamed-chunk-17-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="wcp_2-prior-of-reciprocal-of-degree-of-freedom-of-t-distribution-">WCP<span class="math inline">\(_2\)</span> prior of reciprocal of
degree of freedom of t-distribution.<a class="anchor" aria-label="anchor" href="#wcp_2-prior-of-reciprocal-of-degree-of-freedom-of-t-distribution-"></a>
</h2>
<p>The theoretical implementation details of WCP<span class="math inline">\(_2\)</span> prior of reciprocal of degree of
freedom parameter of t-distribution can be found at Section 5.1 from <a href="https://arxiv.org/pdf/2312.04481.pdf" class="external-link uri">https://arxiv.org/pdf/2312.04481.pdf</a>. Let <span class="math inline">\(\xi\)</span> denote the parameter of interest. To
use our function to construct numerical approximation of WCP prior of a
single parameter, users need to provide the following information in
general:<br>
(1), A function that takes values of the two-dimensional parameter <span class="math inline">\(\theta\)</span> and returns the Wasserstein
distance <span class="math inline">\(W(\theta)\)</span>.<br>
(2), <span class="math inline">\(\theta_0\)</span>, the base model
parameter. (3), <span class="math inline">\(\eta\)</span>, the
user-specified hyperparameter for WCP prior.<br>
(4), cutoff parameter.<br>
(5), Lower and upper bound of the domain of <span class="math inline">\(\theta\)</span> and if the two values are included
or not.<br></p>
<p>Since <span class="math inline">\(\xi\in[0,1/2)\)</span> is a bounded
domain, we do not need to provide the cutoff parameter in this case.
Also, an analytic expression of <span class="math inline">\(W(\xi)\)</span> is not available in our case, we
have to compute it numerically by numerical integration (see Remark 1
from <a href="https://arxiv.org/pdf/2312.04481.pdf" class="external-link uri">https://arxiv.org/pdf/2312.04481.pdf</a>).</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://www.rmetrics.org" class="external-link">fGarch</a></span><span class="op">)</span></span>
<span><span class="co"># The Wasserstein distance function by numerical integration</span></span>
<span><span class="va">W2distanceGt</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">xi</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="co"># xi is 1/nu where nu is dof of t-distribution</span></span>
<span>  <span class="va">integrand</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">p</span>,<span class="va">...</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="fu"><a href="https://geobosh.github.io/fGarchDoc/reference/dist-std.html" class="external-link">qstd</a></span><span class="op">(</span><span class="va">p</span>,<span class="va">...</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">qnorm</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">integral</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/integrate.html" class="external-link">integrate</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Vectorize.html" class="external-link">Vectorize</a></span><span class="op">(</span><span class="va">integrand</span><span class="op">)</span>,<span class="fl">0</span>,<span class="fl">1</span>, </span>
<span>      nu <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="va">xi</span>,subdivisions <span class="op">=</span> <span class="fl">10000L</span><span class="op">)</span><span class="op">$</span><span class="va">value</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span> <span class="op">(</span><span class="va">integral</span><span class="op">^</span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>However, to call the above function frequently is not economic, we
construct an interpolated function for <span class="math inline">\(W(\xi)\)</span> by the following code.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># a sequence of xi</span></span>
<span><span class="va">Xi</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">0.01</span>,to <span class="op">=</span> <span class="fl">0.49</span>,by <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span></span>
<span><span class="co"># obtain a sequence of W(xi) by W2distanceGt function</span></span>
<span><span class="va">W2distance</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">xi</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">Xi</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="co"># skip the case of problematic numerical integration</span></span>
<span>  <span class="va">temp</span> <span class="op">=</span> <span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu">W2distanceGt</span><span class="op">(</span><span class="va">Xi</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span>, silent <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="st">'try-error'</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">temp</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="kw">next</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">W2distance</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">W2distance</span>, <span class="fu">W2distanceGt</span><span class="op">(</span><span class="va">Xi</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span> <span class="op">)</span></span>
<span>  <span class="va">xi</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">xi</span>, <span class="va">Xi</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co"># the interpolated function of W(xi)</span></span>
<span><span class="va">W2d</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/splinefun.html" class="external-link">splinefun</a></span><span class="op">(</span><span class="va">xi</span>, <span class="va">W2distance</span>, method <span class="op">=</span> <span class="st">"hyman"</span><span class="op">)</span></span></code></pre></div>
<p>We determine <span class="math inline">\(\eta\)</span> by requiring
<span class="math inline">\(P(\text{W}(\xi) &gt; U) =
\alpha\)</span>.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">alpha</span> <span class="op">=</span> <span class="fl">0.3</span></span>
<span><span class="va">U</span> <span class="op">=</span> <span class="fl">0.1</span></span>
<span><span class="va">eta</span> <span class="op">=</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">alpha</span><span class="op">)</span><span class="op">/</span><span class="fu">W2d</span><span class="op">(</span><span class="va">U</span><span class="op">)</span></span></code></pre></div>
<p>Now we are ready to call the function to compute numerically
approximated WCP prior. <span class="math inline">\(\text{base_theta}\)</span> is the base model
parameter. <span class="math inline">\(\text{L}\)</span> and <span class="math inline">\(\text{U}\)</span> denote lower and upper bound of
<span class="math inline">\(\theta\)</span>. <span class="math inline">\(\text{L_included}\)</span> and <span class="math inline">\(\text{U_included}\)</span> indicate if <span class="math inline">\(\text{L}\)</span> and <span class="math inline">\(\text{U}\)</span> should be included into the
interval of the parameter of interest. <span class="math inline">\(\text{mesh_width}\)</span> denote mesh width of
the domain. User may instead input <span class="math inline">\(\text{mesh_n}\)</span> which specifies number of
mesh nodes to determine the mesh.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">result</span> <span class="op">=</span> <span class="fu"><a href="../reference/WCP_1D_Numerical_Density.html">WCP_1D_Numerical_Density</a></span><span class="op">(</span>base_theta <span class="op">=</span> <span class="fl">0</span>,</span>
<span>                                   L <span class="op">=</span> <span class="fl">0</span>, </span>
<span>                                   L_included <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                                   U <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>                                   U_included <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                                   W_func <span class="op">=</span> <span class="va">W2d</span>,</span>
<span>                                   eta <span class="op">=</span> <span class="va">eta</span>,</span>
<span>                                   mesh_width <span class="op">=</span> <span class="fl">0.001</span><span class="op">)</span></span></code></pre></div>
<p>The output contains a vector of values of <span class="math inline">\(\xi\)</span> and a vector approximated densities
evaluated at those <span class="math inline">\(\xi\)</span>. The
visualization of the result is:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">result</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, density <span class="op">=</span> <span class="va">result</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">data</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">density</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="numerical_WCP_files/figure-html/unnamed-chunk-22-1.png" width="700"></p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by David Bolin, Alexandre Simas, Zhen Xiong.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
